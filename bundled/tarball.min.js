!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).FilePondPluginTarball=t()}(this,function(){const e={name:100,mode:8,uid:8,gid:8,size:12,mtime:12,chksum:8,typeflag:1,linkname:100,magic:5,version:2,uname:32,gname:32,devmajor:8,devminor:8,prefix:155,padding:12},t={};Object.keys(e).reduce((n,r)=>(t[r]=n,n+e[r]),0);const n=e=>({name:e.name,mode:"777",uid:0,gid:0,size:e.content.byteLength,mtime:Math.floor(Number(new Date)/1e3),chksum:"        ",typeflag:"0",magic:"ustar",version:"  ",uname:"",gname:""}),r=["name","linkname","magic","chksum","typeflag","version","uname","gname"],i=512;function a(e,t){return("000000000000"+(e=e.toString(8))).slice(e.length+12-t)}function o(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}const s={},c=e=>e.substring(0,e.lastIndexOf("."))||e;return(l=!1,u=!1,f)=>({addFilter:m})=>(m("ADD_ITEMS",function(m){try{const h=((l,u,f)=>{if(u){if((e=>{e.filter(e=>e._relativePath).forEach(e=>{const[,t]=e._relativePath.split("/");s[t]||(s[t]=[]),s[t].push(e)})})(l),f){const e=l.filter(e=>!e._relativePath);if(0<e.length){const t=c(e[0].name);s[t]=e}}}else{const e=l.filter(e=>e._relativePath),t=l.filter(e=>!e._relativePath);if(0<e.length){const t=e[0],[,n]=t._relativePath.split("/");s[n]=l}else{const e=c(t[0].name);s[e]=l}}return Object.keys(s).map(c=>{const l=[];return s[c].forEach(e=>{l.push(new Promise(t=>{const n=new FileReader;n.addEventListener("load",n=>{t({name:e._relativePath?e._relativePath.slice(1):e.name,content:new Uint8Array(n.target.result)})}),n.readAsArrayBuffer(e)}))}),delete s[c],function(){try{return Promise.resolve(Promise.all(l)).then(function(s){const l=function(s){let c=new Uint8Array(0);for(let l of s){"string"==typeof l.content&&(l.content=o(l.content)),l=Object.assign(n(l),l);const s=new Uint8Array(Math.ceil((i+l.size)/i)*i),u=Object.keys(e).reduce((n,i)=>{if(!(i in l))return n;const c=o(r.indexOf(i)>-1?l[i]:a(l[i],e[i]-1));return s.set(c,t[i]),n+c.reduce((e,t)=>e+t,0)},0);s.set(o(a(u,7)),t.chksum),s.set(l.content,i);const f=new Uint8Array(c.byteLength+s.byteLength);f.set(c,0),f.set(s,c.byteLength),c=f}const l=new Uint8Array(c.byteLength+1024);return l.set(c,0),l}(s),u=new Blob([l],{type:"application/x-tar"});return new File([u],`${c}.tar`)})}catch(e){return Promise.reject(e)}}})})(m,!l,u);let d=[];return u||(d=m.filter(e=>!e._relativePath)),f?(f(h),Promise.resolve(d)):Promise.resolve(Promise.all(h.map(e=>e()))).then(function(e){return d.concat(e)})}catch(e){return Promise.reject(e)}}),{options:{}})});
