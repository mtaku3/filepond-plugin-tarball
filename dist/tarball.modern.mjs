const e={name:100,mode:8,uid:8,gid:8,size:12,mtime:12,chksum:8,typeflag:1,linkname:100,magic:5,version:2,uname:32,gname:32,devmajor:8,devminor:8,prefix:155,padding:12},t={};Object.keys(e).reduce((n,r)=>(t[r]=n,n+e[r]),0);const n=e=>({name:e.name,mode:"777",uid:0,gid:0,size:e.content.byteLength,mtime:Math.floor(Number(new Date)/1e3),chksum:"        ",typeflag:"0",magic:"ustar",version:"  ",uname:"",gname:""}),r=["name","linkname","magic","chksum","typeflag","version","uname","gname"];function a(e,t){return("000000000000"+(e=e.toString(8))).slice(e.length+12-t)}function s(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}class i extends File{constructor(...e){super(...e),this._relativePath=void 0}}const o={},c=c=>({addFilter:m})=>(m("ADD_ITEMS",async m=>{const u=(c=>((e=>{e.filter(e=>e._relativePath).forEach(e=>{const[,t]=e._relativePath.split("/");o[t]||(o[t]=[]),o[t].push(e)})})(c),Object.keys(o).map(c=>{const m=[];return o[c].forEach(e=>{m.push(new Promise(t=>{const n=new FileReader;n.addEventListener("load",n=>{t({name:e._relativePath.slice(1),content:new Uint8Array(n.target.result)})}),n.readAsArrayBuffer(e)}))}),delete o[c],async()=>{const o=function(i){let o=new Uint8Array(0);for(let c of i){"string"==typeof c.content&&(c.content=s(c.content)),c=Object.assign(n(c),c);const i=new Uint8Array(512*Math.ceil((512+c.size)/512)),m=Object.keys(e).reduce((n,o)=>{if(!(o in c))return n;const m=s(r.indexOf(o)>-1?c[o]:a(c[o],e[o]-1));return i.set(m,t[o]),n+m.reduce((e,t)=>e+t,0)},0);i.set(s(a(m,7)),t.chksum),i.set(c.content,512),sum=new Uint8Array(o.byteLength+i.byteLength),sum.set(o,0),sum.set(i,o.byteLength),o=sum}return sum=new Uint8Array(o.byteLength+1024),sum.set(o,0),sum}(await Promise.all(m)),u=new Blob([o],{type:"application/x-tar"});return new i([u],`${c}.tar`)}})))(m),l=m.filter(e=>!e._relativePath);if(c)return c(u),l;const d=await Promise.all(u.map(e=>e()));return l.concat(d)}),{options:{}});export{c as default};
//# sourceMappingURL=tarball.modern.mjs.map
