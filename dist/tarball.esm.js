const e={name:100,mode:8,uid:8,gid:8,size:12,mtime:12,chksum:8,typeflag:1,linkname:100,magic:5,version:2,uname:32,gname:32,devmajor:8,devminor:8,prefix:155,padding:12},t={};Object.keys(e).reduce((n,r)=>(t[r]=n,n+e[r]),0);const n=["name","linkname","magic","chksum","typeflag","version","uname","gname"];function r(e,t){return("000000000000"+(e=e.toString(8))).slice(e.length+12-t)}function a(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}class i extends File{constructor(...e){super(...e),this._relativePath=void 0}}const o={},s=s=>({addFilter:c})=>(c("ADD_ITEMS",function(c){try{const u=(s=>((e=>{e.filter(e=>e._relativePath).forEach(e=>{const[,t]=e._relativePath.split("/");o[t]||(o[t]=[]),o[t].push(e)})})(s),Object.keys(o).map(s=>{const c=[];return o[s].forEach(e=>{c.push(new Promise((t,n)=>{let r=new FileReader;r.onload=n=>{t({name:e._relativePath,content:n.target.result})},r.readAsArrayBuffer(e)}))}),delete o[s],function(o){try{return Promise.resolve(Promise.all(c)).then(function(o){const c=o.reduce((i,o)=>{"string"==typeof o.content&&(o.content=a(o.content)),o=Object.assign((e=>({name:e.name,mode:"777",uid:0,gid:0,size:e.content.byteLength,mtime:Math.floor(Number(new Date)/1e3),chksum:"        ",typeflag:"0",magic:"ustar",version:"  ",uname:"",gname:""}))(o),o);const s=new Uint8Array(512*Math.ceil((512+o.size)/512)),c=Object.keys(e).reduce((i,c)=>{if(!(c in o))return i;const u=a(n.indexOf(c)>-1?o[c]:r(o[c],e[c]-1));return s.set(u,t[c]),i+u.reduce((e,t)=>e+t,0)},0);s.set(a(r(c,7)),t.chksum),s.set(o.content,512);const u=new Uint8Array(i.byteLength+s.byteLength);return u.set(i,0),u.set(s,i.byteLength),u},new Uint8Array(0)),u=new Blob([c],{type:"application/x-tar"});return new i([u],`${s}.tar`)})}catch(e){return Promise.reject(e)}}})))(c),m=c.filter(e=>!e._relativePath);return s?(s(u),Promise.resolve(m)):Promise.resolve(Promise.all(u.map(e=>e()))).then(function(e){return m.concat(e)})}catch(e){return Promise.reject(e)}}),{options:{}});export{s as default};
//# sourceMappingURL=tarball.esm.js.map
